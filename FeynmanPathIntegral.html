<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>

<!-- d3 -->
<script type="text/javascript" src="libs/d3.v3.min.js"></script>   

<!-- jquery -->
<script type="text/javascript" src="libs/jquery-1.9.1.js"></script>
<script type="text/javascript" src="libs/jquery-ui-1.10.3.custom.js"></script>

<script type="text/javascript" src="libs/underscore-min.js"></script>

 
<!-- helper js functions -->
<!-- <script type="text/javascript" src="js/helperFunctions.js"></script>   -->
 
<!-- css -->
<link rel="stylesheet" type="text/css" href="css/jquery-ui-1.10.3.custom.css"/>
<link rel="stylesheet" type="text/css" href="css/viz_styles.css"/>
    <link href='http://fonts.googleapis.com/css?family=Varela+Round|Carrois+Gothic+SC|Karla|Quantico|Audiowide' rel='stylesheet' type='text/css'>

</head> 

<style>

#sliderNumberOfPaths{
  width: 200px; 
  margin: 10px;
}

#sliderPosition{
  width: 200px; 
  margin: 10px;
}

.customFont{
  font-family: 'Karla' ;
}
 

</style>
<body >
 
  <h1 class="customFont"> Feynman Path Integral in d3.js </h1>

     <div class="toolBar">
        <span class="barTitles">Parameters </span>

        <div class="verticalLine">
        </div>
        <div class="SettingsTextDiv">
          Position
        </div>
        <div id="sliderPosition" class="slider"> 
        </div>
        <div class="SettingsTextDiv" id="sliderValuePosition">

        </div>
        <div class="verticalLine">
        </div>
        <div class="SettingsTextDiv">
           Number of Paths
        </div>
        <div id="sliderNumberOfPaths" class="slider"> 
        </div>
        <div class="SettingsTextDiv" id="sliderValueNumberOfPaths">
        </div>
     </div> 
  <br>
<script>
 
var height =500, width = 500;

var svg = d3.select("body")
            .append("svg")
              .attr("class", "intensityGraph")
              .attr("width", width)
              .attr("height", height)
              .attr("style", "border:1px solid lightgrey;")  

var svg = d3.select("body")
            .append("svg")
              .attr("class", "arrowGraph")
              .attr("width", width)
              .attr("height", height)
              .attr("style", "border:1px solid lightgrey;")  


function initPosition(){
 
  $(function(){
      $( "#sliderPosition" ).slider({min: -10, max: 10, step:1, value:0});
  });
 
  $( "#sliderValuePosition" ).text(position);

  $("#sliderPosition").bind( "slide", function(event, ui) { position  = ui.value;
                                                          $( "#sliderValuePosition" ).text(position);
  });

  console.log(amp(position));
  console.log(pointerModel(position));
}

function initNumberOfPaths(){

  $(function(){
      $( "#sliderNumberOfPaths" ).slider({min: 2, max: 10, step:1, value:6});
  });

  $( "#sliderValueNumberOfPaths" ).text(position);
  $("#sliderNumberOfPaths").bind( "slide", function(event, ui) { nbrOfPaths  = ui.value; 
                                                                 $( "#sliderValueNumberOfPaths" ).text(nbrOfPaths);
  });

}

var position = 0 ;
var nbrOfPaths = 6 ;
var s=300, e=300, lambda=630, a=10, b=0.05;
var z=10/nbrOfPaths;

function phi(_i, _x){

  var term1 = Math.sqrt(Math.pow(s,2) + Math.pow(b,2)*Math.pow(0.5 - (_i/nbrOfPaths+1),2));
  var term2 = Math.sqrt(Math.pow(e,2) + Math.pow(_x - b*(0.5 - (_i/nbrOfPaths+1)),2));

  return (term1+term2)*(10000000/lambda)
}

function deltaPhi(x){
  return phi(1, x) - phi(2, x)
}

function amp(_x){
 
  var sumSin = _.reduce(d3.range(1,nbrOfPaths), 
                        function(memo, num){ 
                          return memo + Math.sin(2*Math.PI*phi(num, _x))
                        },
                      0);
  var sumCos = _.reduce(d3.range(1,nbrOfPaths), 
                        function(memo, num){ 
                          return memo + Math.cos(2*Math.PI*phi(num, _x))
                        },
                      0);
  sumSin *= sumSin;
  sumCos *= sumCos;
  return sumSin+sumCos
}

function pointerModel(_x){

  var pointerValues = [];
  for (var j = 1; j <= nbrOfPaths - 1; j++) {
   

    //create [[val1,val2],[val3,val4]] then push it
    var val1 = _x + _.reduce(d3.range(1,j), 
                        function(memo, num){ 
                          return memo + z * Math.cos(2*Math.PI*num*deltaPhi(_x) + Math.PI/2);
                        },
                      0);
    var val2 = -9 + _.reduce(d3.range(1,j), 
                        function(memo, num){ 
                          return memo + z * Math.sin(2*Math.PI*num*deltaPhi(_x) + Math.PI/2);
                        },
                      0);
                                        //j+1 only difference 
    var val3 = _x + _.reduce(d3.range(1,j+1), 
                        function(memo, num){ 
                          return memo + z * Math.cos(2*Math.PI*num*deltaPhi(_x) + Math.PI/2);
                        },
                      0);
    var val4 = -9 + _.reduce(d3.range(1,j+1), 
                        function(memo, num){ 
                          return memo + z * Math.sin(2*Math.PI*num*deltaPhi(_x) + Math.PI/2);
                        },
                      0);

    pointerValues.push([[val1,val2],[val3,val4]]);

  }

  return pointerValues
}


function initQuantities(){

}

function renderIntensity(){

}

function renderCurrentIntensityLine(){

}

function renderCurrentArrows(){

}

initNumberOfPaths();
initPosition();

</script>


</body>
</html>